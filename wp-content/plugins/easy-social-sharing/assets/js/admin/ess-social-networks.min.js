!function(a,b,c,d){a(function(){var e=a(".ess-social-networks"),f=a(".ess-social-network-rows"),g=a(".ess-social-network-save"),h=c.template("ess-social-network-row"),i=c.template("ess-social-network-row-blank"),j=Backbone.Model.extend({changes:{},logChanges:function(a){var b=this.changes||{};_.each(a,function(a,c){b[c]=_.extend(b[c]||{network_id:c},a)}),this.changes=b,this.trigger("change:networks")},discardChanges:function(a){var b=this.changes||{},c=null,d=_.indexBy(this.get("networks"),"network_id");b[a]&&void 0!==b[a].network_order&&(c=b[a].network_order),delete b[a],null!==c&&d[a]&&d[a].network_order!==c&&(b[a]=_.extend(b[a]||{},{network_id:a,network_order:c})),this.changes=b,0===_.size(this.changes)&&m.clearUnloadConfirmation()},save:function(){_.size(this.changes)?a.post(d+(d.indexOf("?")>0?"&":"?")+"action=easy_social_sharing_social_networks_save_changes",{ess_social_networks_nonce:b.ess_social_networks_nonce,changes:this.changes},this.onSaveResponse,"json"):l.trigger("saved:networks")},onSaveResponse:function(a,c){"success"===c&&(a.success?(l.set("networks",a.data.social_networks),l.trigger("change:networks"),l.changes={},l.trigger("saved:networks")):window.alert(b.strings.save_failed))}}),k=Backbone.View.extend({rowTemplate:h,initialize:function(){this.listenTo(this.model,"change:networks",this.setUnloadConfirmation),this.listenTo(this.model,"saved:networks",this.clearUnloadConfirmation),this.listenTo(this.model,"saved:networks",this.render),f.on("change",{view:this},this.updateModelOnChange),f.on("sortupdate",{view:this},this.updateModelOnSort),a(window).on("beforeunload",{view:this},this.unloadConfirmation),g.on("click",{view:this},this.onSubmit),a(document.body).on("click",".ess-social-network-add",{view:this},this.onAddNewRow)},block:function(){a(this.el).block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){a(this.el).unblock()},render:function(){var c=_.indexBy(this.model.get("networks"),"network_id"),d=this;this.$el.empty(),this.unblock(),_.size(c)?(c=_.sortBy(c,function(a){return parseInt(a.network_order,10)}),a.each(c,function(a,c){"1"===c.is_api_support?c.api_support_icon='<mark class="yes"><span class="dashicons dashicons-yes tips" data-tip="'+b.strings.yes+'"></span>':c.api_support_icon='<mark class="no"><span class="dashicons dashicons-no-alt tips" data-tip="'+b.strings.no+'"></span>',d.renderRow(c)})):d.$el.append(i),d.initRows()},renderRow:function(a){var b=this;b.$el.append(b.rowTemplate(a)),b.initRow(a)},initRow:function(b){var c=this,d=c.$el.find('tr[data-id="'+b.network_id+'"]');d.find("select").each(function(){var c=a(this).data("attribute");a(this).find('option[value="'+b[c]+'"]').prop("selected",!0)}),d.find(".view").show(),d.find(".edit").hide(),d.find(".ess-social-network-edit").on("click",{view:this},this.onEditRow),d.find(".ess-social-network-delete").on("click",{view:this},this.onDeleteRow),d.find(".editing .ess-social-network-edit").trigger("click"),d.find(".ess-social-network-cancel-edit").on("click",{view:this},this.onCancelEditRow),!0===b.editing&&(d.addClass("editing"),d.find(".ess-social-network-edit").trigger("click"))},initRows:function(){0===a("tbody.ess-social-network-rows tr").length%2?e.find("tbody.ess-social-network-rows").next("tbody").find("tr").addClass("odd"):e.find("tbody.ess-social-network-rows").next("tbody").find("tr").removeClass("odd"),a("#tiptip_holder").removeAttr("style"),a("#tiptip_arrow").removeAttr("style"),a(".tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:50})},onSubmit:function(a){a.data.view.block(),a.data.view.model.save(),a.preventDefault()},onAddNewRow:function(c){c.preventDefault();var d=c.data.view,e=d.model,f=_.indexBy(e.get("networks"),"network_id"),g={},h=_.size(f),i=_.extend({},b.default_social_network,{network_id:"new-"+h+"-"+Date.now(),editing:!0,newRow:!0});a(".ess-social-network-blank-state").closest("tr").remove(),i.network_order=1+_.max(_.pluck(f,"network_order"),function(a){return parseInt(a,10)}),g[i.network_id]=i,e.logChanges(g),d.renderRow(i),d.initRows()},onEditRow:function(b){b.preventDefault(),b.data.view.model.trigger("change:networks"),a(this).closest("tr").addClass("editing"),a(this).closest("tr").find(".view").hide(),a(this).closest("tr").find(".edit").show(),a(document.body).trigger("ess-enhanced-select-init"),a(".tips").tipTip({attribute:"data-disabled-tip",fadeIn:50,fadeOut:50,delay:50})},onCancelEditRow:function(b){var c=b.data.view,d=c.model,e=a(this).closest("tr"),f=a(this).closest("tr").data("id"),g=_.indexBy(d.get("networks"),"network_id");b.preventDefault(),d.discardChanges(f),g[f]&&(g[f].editing=!1,e.after(c.rowTemplate(g[f])),c.initRow(g[f])),e.remove(),c.render(),c.initRows()},onDeleteRow:function(b){var c=b.data.view,d=c.model,e=_.indexBy(d.get("networks"),"network_id"),f={},g=a(this).closest("tr"),h=a(this).closest("tr").data("id");b.preventDefault(),e[h]&&(delete e[h],f[h]=_.extend(f[h]||{},{deleted:"deleted"}),d.set("networks",e),d.logChanges(f)),g.remove(),c.render(),c.initRows()},setUnloadConfirmation:function(){this.needsUnloadConfirm=!0,g.removeAttr("disabled")},clearUnloadConfirmation:function(){this.needsUnloadConfirm=!1,g.attr("disabled",!0)},unloadConfirmation:function(a){return a.data.view.needsUnloadConfirm?(a.returnValue=b.strings.unload_confirmation_msg,window.event.returnValue=b.strings.unload_confirmation_msg,b.strings.unload_confirmation_msg):void 0},updateModelOnChange:function(b){var c=b.data.view.model,d=a(b.target),e=d.closest("tr").data("id"),f=d.data("attribute"),g=d.val(),h=_.indexBy(c.get("networks"),"network_id"),i={};h[e]&&h[e][f]===g||(i[e]={},i[e][f]=g),c.logChanges(i)},updateModelOnSort:function(b){var c=b.data.view,d=c.model,e=_.indexBy(d.get("networks"),"network_id"),f=a("tbody.ess-social-network-rows tr"),g={};_.each(f,function(b){var c=a(b).data("id"),d=null,f=parseInt(a(b).index(),10);e[c]&&(d=parseInt(e[c].network_order,10)),d!==f&&(g[c]=_.extend(g[c]||{},{network_order:f}))}),_.size(g)&&d.logChanges(g)}}),l=new j({networks:b.networks}),m=new k({model:l,el:f});m.render(),f.sortable({items:"tr",cursor:"move",axis:"y",handle:"td.ess-social-network-sort",scrollSensitivity:40})})}(jQuery,socialNetworksLocalizeScript,wp,ajaxurl);